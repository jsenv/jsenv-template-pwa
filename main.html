<!DOCTYPE html>
<html lang="en">
  <head>
    <title>PWA Example</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="./icons/favicon.png" />
    <link rel="manifest" href="./pwa.webmanifest" />
    <!--
      boot.css is responsible to set styles the very first styles displayed when
      - JavaScript is disabled
      - Browser is not supported
      - App is "booting"
        - "booting" is when code in this HTML file will try to fetch the first ressource from network
        - Files implementing the booting of the application actually inlined in this HTML
          during build by [data-jsenv-force-inline] attribute
    --->
    <link rel="stylesheet" href="./src/boot/boot.css" data-jsenv-force-inline />
    <!--
      Tell browser to start fetching theses ressources right now:
      - The font
      - CSS and JS used to load the app
      - CSS and JS of the app
    -->
    <link
      rel="preload"
      href="./src/app_loader/roboto-v27-latin-regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="./src/app_loader/app_loader.css"
      as="style"
      crossorigin
    />
    <link
      rel="preload"
      href="./src/app_loader/app_loader.js"
      as="script"
      crossorigin
    />
    <link rel="preload" href="./src/app/app.css" as="style" crossorigin />
    <link rel="preload" href="./src/app/app.js" as="script" crossorigin />
    <!--
      This HTML uses "dev.importmap" controlling how js import are resolved so that

      import { DEV } from "#env"
      if (DEV) alert('Hi dev!')

      Would display an alert dialog during dev but not in prod.
      This is because alert would be removed by tree shaking during the build

      Read more at https://github.com/jsenv/jsenv-template-pwa/blob/main/docs/production_mode/readme.md#production-mod
    -->
    <script type="importmap" src="./dev.importmap"></script>
  </head>

  <body>
    <!--
      Handles JavaScript disabled use case
    -->
    <noscript>
      <h1>JavaScript is required</h1>
      <p>This page needs JavaScript to run but JavaScript is not available</p>
    </noscript>

    <!--
      Handled browser not supported use case

      Js detects if browser is supported and displays "browser not supported" dom node
      when browser is not supported.

      When browser is not supported, the application won't try to boot.
    -->
    <div id="browser_not_supported" style="display: none">
      <h1>Browser not supported</h1>
      <p>Please update your internet browser or try with an other one</p>
    </div>
    <script
      src="./src/boot/browser_support_detection.js"
      data-jsenv-force-inline
    ></script>

    <!--
      Booting the application

      <div id="app"> is hidden until [data-booting] is removed which happens when
      "app_loader.js" calls window.splashscreen.appIsReady()

      <div id="splashscreen"> is displayed when:
      - Network is slow and "app_loader.js" takes time to fetch
      - Error while fetching, parsing or executing "app_loader.js"
      - Application "started" in less than 300ms (yes it happens thanks to service worker)

      The code implementing this logic is configurable and visible in "boot.js"
    -->
    <div id="app" data-booting></div>
    <div id="splashscreen">
      <div id="splashscreen_logo">
        <img src="./src/logo.png" data-jsenv-force-inline />
      </div>
      <div id="splashscreen_brand">PWA template</div>
      <div id="splashscreen_message"></div>
      <div style="display: none">
        <div id="booting_start"></div>
        <div id="booting_is_slow">Booting...</div>
        <div id="booting_error">
          <p>An error occured while booting</p>
          <br />
          <details>
            <summary>See error stack</summary>
            <pre id="boot_runtime_error_stack">${errorStack}</pre>
          </details>
        </div>
      </div>
    </div>
    <script
      type="module"
      src="./src/boot/boot.js"
      data-jsenv-force-inline
    ></script>

    <!--
      Early beforeinstallprompt listener

      We must listen to "beforeinstallprompt" as soon as possible or it could be missed.
      The event is stored in window.beforeinstallpromptEvent to be used later
    -->
    <script>
      window.addEventListener(
        "beforeinstallprompt",
        (beforeinstallpromptEvent) => {
          beforeinstallpromptEvent.preventDefault()
          window.beforeinstallpromptEvent = beforeinstallpromptEvent
        },
      )
    </script>
  </body>
</html>
