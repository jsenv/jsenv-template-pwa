{
  "version": 3,
  "file": "boot.js",
  "sources": [
    "../../src/boot/boot.js"
  ],
  "sourcesContent": [
    "/*\n * This file is inlined in the HTML file by [data-jsenv-force-inline]\n * Responsabilities:\n * - inject the dev ribbon in development mode\n * - Dynamic import of \"app_loader.js\" (fetch+parse+execute)\n *   - Catch error during the dynamic import\n *   - Display splashscreen during this dynamic import\n * - Call loadApp exported by \"app_loader.js\"\n *   - Provide an updateSplashscreenText\n *   - Hide splashscreen once app is ready to be displayed\n */\n\nimport { DEV } from \"#env\"\n\nif (DEV) {\n  const { injectDevRibbon } = await import(\"./dev_ribbon.js\")\n  injectDevRibbon()\n}\n\n// When it take more than \"BOOTING_SLOW\"ms for loadApp to resolve or call updateSplashscreenText\n// -> splashscreen displays <div id=\"booting_is_slow\"> content\nconst BOOTING_SLOW = 2500\n// When it takes less than \"SPLASHIN_DELAY\"ms for loadApp to resolve\n// -> we won't even show the splashscreen (happens on user second visit because everything is in browser cache)\nconst SPLASHIN_DELAY = 300\n// When less than \"SPLASHOUT_MIN_INTERVAL\"ms have ellapsed since splashin animation started\n// -> code ensures \"SPLASHOUT_MIN_INTERVAL\"ms ellapses before playing the splashout animation\n// This is to prevent a disturbing blink when loadApp resolves shortly after splashin animation\nconst SPLASHOUT_MIN_INTERVAL = 650\n\nconst appNode = document.querySelector(\"#app\")\nconst splashscreenNode = document.querySelector(\"#splashscreen\")\n\nconst BOOTING_START = \"booting_start\"\nconst BOOTING_IS_SLOW = \"booting_is_slow\"\nconst BOOTING_ERROR = \"booting_error\"\n\nconst boot = async () => {\n  if (DEV) {\n    performance.measure(`booting app`)\n  }\n\n  const bootStartMs = Date.now()\n\n  let splashIsVisible = false\n  const splashin = () => {\n    splashscreenNode.setAttribute(\"data-splashin\", \"\")\n    splashIsVisible = true\n  }\n\n  const splashout = async () => {\n    splashscreenNode.setAttribute(\"data-splashout\", \"\")\n    await new Promise((resolve) => {\n      setTimeout(() => {\n        splashIsVisible = false\n        resolve()\n      }, 300)\n    })\n  }\n\n  const killSplashscreen = () => {\n    // Here splashscreen is \"killed\" with display: 'none' but it could also\n    // be removed from the DOM\n    splashscreenNode.style.display = \"none\"\n    splashIsVisible = false\n    if (DEV) {\n      performance.measure(`app displayed`)\n    }\n  }\n\n  const splashInTimeout = setTimeout(splashin, SPLASHIN_DELAY)\n\n  const bootingIsSlowTimeout = setTimeout(() => {\n    setBootingState(BOOTING_IS_SLOW)\n  }, BOOTING_SLOW)\n\n  try {\n    setBootingState(BOOTING_START)\n    const { loadApp } = await import(\"../app_loader/app_loader.js\")\n    await loadApp({\n      updateSplashscreenText: (message) => {\n        clearTimeout(bootingIsSlowTimeout)\n        const splashscreenMessageNode = document.querySelector(\n          \"#splashscreen_message\",\n        )\n        splashscreenMessageNode.innerHTML = message\n      },\n    })\n\n    clearTimeout(splashInTimeout)\n    clearTimeout(bootingIsSlowTimeout)\n\n    if (!splashIsVisible) {\n      appNode.removeAttribute(\"data-booting\")\n      // app was super fast to load, splashscreen was not even displayed, cool\n      killSplashscreen()\n      return\n    }\n\n    const splashInMs = bootStartMs + SPLASHIN_DELAY\n    const msEllapsedSinceSplashIn = Date.now() - splashInMs\n\n    if (msEllapsedSinceSplashIn < SPLASHOUT_MIN_INTERVAL) {\n      const msToWaitToPreventBlink =\n        SPLASHOUT_MIN_INTERVAL - msEllapsedSinceSplashIn\n      await new Promise((resolve) => {\n        setTimeout(resolve, msToWaitToPreventBlink)\n      })\n    }\n\n    appNode.removeAttribute(\"data-booting\")\n    // Wait the end of the \"splashout\" animation before killing splashscreen entirely\n    await splashout()\n    killSplashscreen()\n  } catch (error) {\n    clearTimeout(bootingIsSlowTimeout)\n\n    setBootingState(BOOTING_ERROR, {\n      errorStack:\n        error.stack ||\n        `<No stack associated with this error> (Check devtools to get more info)`,\n    })\n    throw error\n  }\n}\n\nconst setBootingState = (nextBootingState, data = {}) => {\n  const splashscreenMessageNode = document.querySelector(\n    \"#splashscreen_message\",\n  )\n  splashscreenMessageNode.innerHTML = \"\"\n  const variantModel = document.querySelector(`#${nextBootingState}`)\n  const variantInstance = variantModel.cloneNode(true)\n\n  replaceNodeVariables(variantInstance, data)\n  splashscreenMessageNode.appendChild(variantInstance)\n}\n\nconst replaceNodeVariables = (node, data) => {\n  if (node.nodeName === \"#text\") {\n    node.textContent = node.textContent.replace(/\\${(\\w*)}/g, (_, key) => {\n      return data.hasOwnProperty(key) ? data[key] : \"\"\n    })\n    return\n  }\n\n  Array.from(node.childNodes).forEach((node) => {\n    replaceNodeVariables(node, data)\n  })\n}\n\nif (window.browserIsSupported) {\n  await boot()\n}\n"
  ],
  "names": [
    "value",
    "direct",
    "then",
    "Promise",
    "resolve",
    "body",
    "result",
    "e",
    "reject",
    "recover",
    "f",
    "args",
    "i",
    "arguments",
    "length",
    "apply",
    "injectDevRibbon",
    "BOOTING_SLOW",
    "SPLASHIN_DELAY",
    "SPLASHOUT_MIN_INTERVAL",
    "appNode",
    "document",
    "querySelector",
    "splashscreenNode",
    "BOOTING_START",
    "BOOTING_IS_SLOW",
    "BOOTING_ERROR",
    "boot",
    "performance",
    "measure",
    "bootStartMs",
    "Date",
    "now",
    "splashIsVisible",
    "splashin",
    "setAttribute",
    "splashout",
    "setTimeout",
    "killSplashscreen",
    "style",
    "display",
    "splashInTimeout",
    "bootingIsSlowTimeout",
    "setBootingState",
    "loadApp",
    "updateSplashscreenText",
    "message",
    "clearTimeout",
    "splashscreenMessageNode",
    "innerHTML",
    "removeAttribute",
    "splashInMs",
    "msEllapsedSinceSplashIn",
    "msToWaitToPreventBlink",
    "error",
    "errorStack",
    "stack",
    "nextBootingState",
    "data",
    "variantModel",
    "variantInstance",
    "cloneNode",
    "replaceNodeVariables",
    "appendChild",
    "node",
    "nodeName",
    "textContent",
    "replace",
    "_",
    "key",
    "hasOwnProperty",
    "Array",
    "from",
    "childNodes",
    "forEach",
    "window",
    "browserIsSupported"
  ],
  "mappings": "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"
}